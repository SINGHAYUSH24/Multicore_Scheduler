<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Priority Allocation - Gantt Chart</title>
    <style>
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
      
        input[type="number"] {
            -moz-appearance: textfield;
        }
      </style>      
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-yellow-400 font-sans">
    <div class="container mx-auto p-6 text-center">
        <h1 class="text-3xl font-bold mb-6">Dynamic Priority Allocation - Gantt Chart</h1>
        
        <div class="grid md:grid-cols-3 gap-4 bg-gray-800 p-6 rounded-lg shadow-lg">
            <input type="number" id="priority" placeholder="Priority"
                   class="w-full p-2 bg-gray-700 text-white rounded appearance-none">
            <input type="number" id="executionTime" placeholder="Execution Time (sec)"
                   class="w-full p-2 bg-gray-700 text-white rounded appearance-none">
            <input type="number" id="arrivalTime" placeholder="Arrival Time (sec)"
                   class="w-full p-2 bg-gray-700 text-white rounded appearance-none">
        </div>

        <div class="mt-4 flex justify-center space-x-4">
            <button onclick="addTask()" class="bg-green-600 px-4 py-2 rounded hover:bg-green-500">
                Add Task
            </button>
            <button onclick="startExecution()" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-500">
                Start Execution
            </button>
            <button onclick="clearTasks()" class="bg-red-600 px-4 py-2 rounded hover:bg-red-500">
                Clear
            </button>
        </div>

        <div class="mt-6 bg-gray-800 p-4 rounded-lg shadow-lg">
            <h2 class="text-xl font-bold">Task List</h2>
            <div id="taskList" class="text-white"></div>
        </div>

        <div class="grid md:grid-cols-2 gap-4 mt-6">
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                <h2 class="text-xl font-bold">Execution Log</h2>
                <pre id="log" class="text-white"></pre>
            </div>
            <div class="bg-gray-800 p-4 rounded-lg shadow-lg">
                <h2 class="text-xl font-bold">Preemption Log</h2>
                <pre id="preemptionLog" class="text-white"></pre>
            </div>
        </div>

        <div class="mt-6 bg-gray-800 p-4 rounded-lg shadow-lg">
            <h2 class="text-xl font-bold">Gantt Chart</h2>
            <canvas id="ganttChart" class="bg-white"></canvas>
        </div>
        
        <footer class="mt-6 text-lg text-yellow-400 font-bold">
            Dynamic Process Scheduler 2025
        </footer>
    </div>

    <script>
        let tasks = [];
        let cores = Array(4).fill(null);
        let executionLog = [];
        let preemptionLog = [];
        let ganttData = [];

        function addTask() {
            let priority = parseInt(document.getElementById("priority").value);
            let executionTime = parseInt(document.getElementById("executionTime").value);
            let arrivalTime = parseInt(document.getElementById("arrivalTime").value);

            if (isNaN(priority) || isNaN(executionTime) || isNaN(arrivalTime) || executionTime <= 0) {
                alert("Please enter valid priority, execution time, and arrival time.");
                return;
            }

            let taskId = tasks.length + 1;
            let task = { id: taskId, priority, executionTime, arrivalTime, remainingTime: executionTime };
            tasks.push(task);
            tasks.sort((a, b) => a.arrivalTime - b.arrivalTime || a.priority - b.priority);
            displayTasks();
        }

        function displayTasks() {
            let taskListDiv = document.getElementById("taskList");
            taskListDiv.innerHTML = tasks.map(task =>
                `Task ${task.id}: Priority ${task.priority}, Execution: ${task.executionTime} sec, Arrival: ${task.arrivalTime} sec`
            ).join("<br>");
        }

        function startExecution() {
            let time = 0;
            let interval = setInterval(() => {
                let arrivedTasks = tasks.filter(t => t.arrivalTime <= time && t.remainingTime > 0);
                arrivedTasks.sort((a, b) => a.priority - b.priority);

                arrivedTasks.forEach(task => {
                    let alreadyAssigned = cores.some(coreTask => coreTask && coreTask.id === task.id);
                    if (alreadyAssigned) return;

                    let freeCoreIndex = cores.findIndex(core => core === null);
                    if (freeCoreIndex !== -1) {
                        cores[freeCoreIndex] = task;
                        executionLog.push(`Task ${task.id} assigned to Core ${freeCoreIndex + 1} at ${time} sec`);
                    } else {
                        let lowestPriorityIndex = -1;
                        let lowestPriority = -1;

                        for (let i = 0; i < cores.length; i++) {
                            if (cores[i] && (lowestPriorityIndex === -1 || cores[i].priority > lowestPriority)) {
                                lowestPriority = cores[i].priority;
                                lowestPriorityIndex = i;
                            }
                        }

                        if (lowestPriorityIndex !== -1 && cores[lowestPriorityIndex].priority > task.priority) {
                            let preemptedTask = cores[lowestPriorityIndex];
                            cores[lowestPriorityIndex] = task;
                            executionLog.push(`Task ${task.id} preempted Task ${preemptedTask.id} on Core ${lowestPriorityIndex + 1} at ${time} sec`);
                            preemptionLog.push(`Task ${preemptedTask.id} preempted by Task ${task.id} at ${time} sec`);
                        }
                    }
                });

                let activeCores = 0;
                for (let i = 0; i < cores.length; i++) {
                    if (cores[i]) {
                        cores[i].remainingTime--;
                        ganttData.push({ core: i + 1, task: cores[i].id, time });
                        activeCores++;

                        if (cores[i].remainingTime === 0) {
                            executionLog.push(`Task ${cores[i].id} completed on Core ${i + 1} at ${time + 1} sec`);
                            cores[i] = null;
                        }
                    }
                }

                time++;
                updateLogs();

                if (tasks.every(t => t.remainingTime <= 0) && activeCores === 0) {
                    clearInterval(interval);
                    drawGanttChart();
                }
            }, 1000);
        }

        function updateLogs() {
            document.getElementById("log").innerText = executionLog.join("\n");
            document.getElementById("preemptionLog").innerText = preemptionLog.join("\n");
        }

        function drawGanttChart() {
            let ctx = document.getElementById("ganttChart").getContext("2d");
            let labels = [...new Set(ganttData.map(d => d.time))];
            let datasets = [];

            for (let i = 1; i <= 4; i++) {
                datasets.push({
                    label: `Core ${i}`,
                    data: ganttData.filter(d => d.core === i).map(d => ({ x: d.time, y: d.task })),
                    borderColor: `hsl(${i * 90}, 70%, 50%)`,
                    borderWidth: 2,
                    fill: false
                });
            }

            new Chart(ctx, { type: "line", data: { labels, datasets }, options: { scales: { x: { beginAtZero: true } } } });
        }

        function clearTasks() {
            location.reload();
        }
    </script>
</body>
</html>
